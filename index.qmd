---
title: ""
format:
  html:
    toc: false
    page-layout: full
execute:
  echo: false
jupyter: python3
---

```{python}
#| include: false
import json
import re
from pathlib import Path
from IPython.display import display, HTML

# Load stats from processed data
stats_file = Path("data/recap_stats.json")
if stats_file.exists():
    with open(stats_file) as f:
        stats = json.load(f)
else:
    stats = {"year": 2025, "error": "No data found"}

def highlight_numbers(text):
    """Highlight numbers in text with span tags."""
    return re.sub(r'(\d+\.?\d*)', r'<span class="highlight">\1</span>', text)

year = stats.get("year", 2025)
hours = stats.get("estimated_hours", 0)
days = stats.get("estimated_days", 0)
total = stats.get("total_titles_watched", 0)
shows = stats.get("unique_shows", 0)
top_show = stats.get("number_one_show", "Unknown")
top_count = stats.get("number_one_count", 0)
top_minutes = stats.get("number_one_minutes", 0)
personality = stats.get("personality", {})
active_days = stats.get("active_days", 0)
top_shows = stats.get("top_shows", [])
streak = stats.get("longest_streak", 0)
binges = stats.get("binge_sessions", 0)
fav_day = stats.get("favorite_day", "Unknown")
biggest_binge = stats.get("biggest_binge", 0)
biggest_binge_show = stats.get("biggest_binge_show", "Unknown")
movies = stats.get("movies_watched", 0)
episodes = stats.get("episodes_watched", 0)
peak_month = stats.get("peak_month", "Unknown")
peak_month_count = stats.get("peak_month_count", 0)
peak_time = stats.get("peak_time", "Unknown")
top_device = stats.get("top_device", "Unknown")
monthly = stats.get("monthly_breakdown", {})
dow = stats.get("day_of_week", {})
time_cats = stats.get("time_categories", {})
facts = stats.get("fun_facts", [])
```

```{python}
# Build top shows HTML
top_shows_html = ""
for i, show in enumerate(top_shows[:5]):
    rank_class = "gold" if i == 0 else "silver" if i == 1 else "bronze" if i == 2 else ""
    hours_watched = round(show['minutes'] / 60, 1)
    top_shows_html += f'''
    <div class="show-item">
        <div class="show-rank {rank_class}">{i + 1}</div>
        <div class="show-details">
            <div class="show-name">{show['title']}</div>
            <div class="show-meta">{show['count']} plays · {hours_watched}h watched</div>
        </div>
    </div>
    '''

# Build monthly chart HTML
max_monthly = max(monthly.values()) if monthly else 1
months_short = ["J", "F", "M", "A", "M", "J", "J", "A", "S", "O", "N", "D"]
months_full = ["January", "February", "March", "April", "May", "June", 
               "July", "August", "September", "October", "November", "December"]
monthly_html = ""
for short, full in zip(months_short, months_full):
    count = monthly.get(full, 0)
    height = (count / max_monthly) * 100 if max_monthly > 0 else 0
    is_peak = full == peak_month
    monthly_html += f'''<div class="bar-col"><div class="bar {"peak" if is_peak else ""}" style="height: {height}%;"></div><span>{short}</span></div>'''

# Build day of week HTML  
max_dow = max(dow.values()) if dow else 1
dow_html = ""
days_short = ["M", "T", "W", "T", "F", "S", "S"]
days_full = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
for short, full in zip(days_short, days_full):
    count = dow.get(full, 0)
    height = (count / max_dow) * 100 if max_dow > 0 else 0
    is_fav = full == fav_day
    dow_html += f'''<div class="bar-col"><div class="bar {"peak" if is_fav else ""}" style="height: {height}%;"></div><span>{short}</span></div>'''

# Build time of day HTML
total_time = sum(time_cats.values()) or 1
time_html = ""
time_order = ["Morning (6am-12pm)", "Afternoon (12pm-6pm)", "Evening (6pm-10pm)", "Night Owl (10pm-6am)"]
time_labels = ["Morning", "Afternoon", "Evening", "Night"]
time_icons = ["6am", "12pm", "6pm", "10pm"]
for slot, label, icon in zip(time_order, time_labels, time_icons):
    count = time_cats.get(slot, 0)
    pct = round((count / total_time) * 100)
    is_peak = slot == peak_time
    time_html += f'''
    <div class="time-slot {"active" if is_peak else ""}">
        <span class="time-icon">{icon}</span>
        <span class="time-label">{label}</span>
        <span class="time-pct">{pct}%</span>
    </div>
    '''

# Build fun facts HTML with SVG icons
icon_svgs = {
    "clock": '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>',
    "grid": '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>',
    "moon": '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>',
    "calendar": '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>'
}

facts_html = ""
for fact in facts:
    if isinstance(fact, dict):
        icon_svg = icon_svgs.get(fact.get('icon', 'clock'), icon_svgs['clock'])
        facts_html += f'''<div class="fact-card">
            <div class="fact-icon">{icon_svg}</div>
            <div class="fact-stat">{fact.get('stat', '')}</div>
            <div class="fact-label">{fact.get('label', '')}</div>
        </div>'''
    else:
        facts_html += f'<div class="fact-item">{highlight_numbers(fact)}</div>'

# Calculate additional stats
avg_per_week = round(total / 52, 1)
night_pct = round((time_cats.get("Night Owl (10pm-6am)", 0) / total_time) * 100)

display(HTML(f'''
<div class="carousel-container">
    <div class="carousel">
        <!-- Slide 1: Intro -->
        <div class="slide active" data-slide="0">
            <div class="slide-content intro">
                <img src="images/netflix-logo.png" alt="Netflix" class="netflix-logo">
                <h1>YOUR {year}</h1>
                <h2>RECAP</h2>
                <p class="subtitle">Let's see what you've been watching...</p>
                <div class="scroll-hint">
                    <span>Tap to start</span>
                    <div class="arrow">→</div>
                </div>
            </div>
        </div>

        <!-- Slide 2: Total Time -->
        <div class="slide" data-slide="1">
            <div class="slide-content">
                <div class="slide-label">This year, you spent</div>
                <div class="big-number">{hours:,.0f}</div>
                <div class="big-label">hours streaming</div>
                <div class="sub-stat">That's <span class="highlight">{days:.1f} days</span> of your life.</div>
                <div class="sub-stat">Worth it? Absolutely.</div>
            </div>
        </div>

        <!-- Slide 3: Titles Count -->
        <div class="slide" data-slide="2">
            <div class="slide-content">
                <div class="slide-label">You watched</div>
                <div class="big-number">{total:,}</div>
                <div class="big-label">titles</div>
                <div class="stat-row">
                    <div class="mini-stat">
                        <span class="mini-number">{episodes}</span>
                        <span class="mini-label">episodes</span>
                    </div>
                    <div class="mini-stat">
                        <span class="mini-number">{movies}</span>
                        <span class="mini-label">movies</span>
                    </div>
                </div>
                <div class="sub-stat">Across <span class="highlight">{shows}</span> different shows</div>
            </div>
        </div>

        <!-- Slide 4: #1 Show -->
        <div class="slide" data-slide="3">
            <div class="slide-content">
                <div class="slide-label">Your #1 show was</div>
                <div class="trophy">#1</div>
                <div class="featured-show">{top_show}</div>
                <div class="show-stats-detail">
                    <span class="highlight">{top_count}</span> plays
                    <span class="divider">·</span>
                    <span class="highlight">{round(top_minutes/60, 1)}</span> hours
                </div>
                <div class="sub-stat">You really couldn't get enough</div>
            </div>
        </div>

        <!-- Slide 5: Top 5 -->
        <div class="slide" data-slide="4">
            <div class="slide-content">
                <div class="slide-label">Your Top 5</div>
                <div class="top-shows-list">
                    {top_shows_html}
                </div>
            </div>
        </div>

        <!-- Slide 6: When You Watch - Monthly -->
        <div class="slide" data-slide="5">
            <div class="slide-content">
                <div class="slide-label">Your year at a glance</div>
                <div class="chart-container">
                    <div class="bar-chart">
                        {monthly_html}
                    </div>
                </div>
                <div class="sub-stat"><span class="highlight">{peak_month}</span> was your peak month</div>
                <div class="sub-stat faded">{peak_month_count} titles watched</div>
            </div>
        </div>

        <!-- Slide 7: Day & Time -->
        <div class="slide" data-slide="6">
            <div class="slide-content">
                <div class="slide-label">When you watch</div>
                <div class="time-grid">
                    {time_html}
                </div>
                <div class="sub-stat" style="margin-top: 2rem;">
                    <span class="highlight">{night_pct}%</span> of watching after 10pm
                </div>
                <div class="sub-stat faded">Your melatonin is confused</div>
            </div>
        </div>

        <!-- Slide 8: Your Dedication -->
        <div class="slide" data-slide="7">
            <div class="slide-content">
                <div class="slide-label">Your dedication</div>
                <div class="streak-display">
                    <div class="streak-number">{streak}</div>
                    <div class="streak-label">day streak</div>
                </div>
                <div class="stat-row" style="margin-top: 2rem;">
                    <div class="mini-stat">
                        <span class="mini-number">{binges}</span>
                        <span class="mini-label">binge sessions</span>
                    </div>
                    <div class="mini-stat">
                        <span class="mini-number">{active_days}</span>
                        <span class="mini-label">active days</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 9: Most Binged -->
        <div class="slide" data-slide="8">
            <div class="slide-content">
                <div class="slide-label">Most binged</div>
                <div class="streak-display">
                    <div class="streak-number">{biggest_binge}</div>
                    <div class="streak-label">episodes in one sitting</div>
                </div>
                <div class="binge-show-name" style="margin-top: 1.5rem;">{biggest_binge_show}</div>
                <div class="sub-stat">Now that's commitment</div>
            </div>
        </div>

        <!-- Slide 10: Personality -->
        <div class="slide" data-slide="9">
            <div class="slide-content">
                <div class="slide-label">Your streaming personality</div>
                <div class="personality-icon"><img src="images/chiller.svg" alt="Serial Chiller"></div>
                <div class="personality-type">{personality.get('type', 'The Streamer')}</div>
                <div class="personality-desc">{personality.get('description', '')}</div>
            </div>
        </div>

        <!-- Slide 11: Fun Facts -->
        <div class="slide" data-slide="10">
            <div class="slide-content">
                <div class="slide-label">By the numbers</div>
                <div class="facts-grid">
                    {facts_html}
                </div>
            </div>
        </div>

        <!-- Slide 12: Outro -->
        <div class="slide" data-slide="11">
            <div class="slide-content outro">
                <img src="images/netflix-logo.png" alt="Netflix" class="netflix-logo">
                
                <h2>Thanks for streaming</h2>
                <p class="outro-text">Same time next year?</p>
                <a href="https://github.com/isfarbaset/netflix-recap" target="_blank" class="github-btn" title="View on GitHub">
                    <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="carousel-nav">
        <button class="nav-btn prev" onclick="prevSlide()">‹</button>
        <div class="dots"></div>
        <button class="nav-btn next" onclick="nextSlide()">›</button>
    </div>

    <!-- Progress bar -->
    <div class="progress-bar">
        <div class="progress-fill"></div>
    </div>
</div>

<script>
let currentSlide = 0;
const totalSlides = document.querySelectorAll('.slide').length;

// Create dots
const dotsContainer = document.querySelector('.dots');
for (let i = 0; i < totalSlides; i++) {{
    const dot = document.createElement('div');
    dot.className = 'dot' + (i === 0 ? ' active' : '');
    dot.onclick = () => goToSlide(i);
    dotsContainer.appendChild(dot);
}}

function updateSlide() {{
    document.querySelectorAll('.slide').forEach((slide, i) => {{
        slide.classList.remove('active', 'prev');
        if (i === currentSlide) slide.classList.add('active');
        if (i < currentSlide) slide.classList.add('prev');
    }});
    
    document.querySelectorAll('.dot').forEach((dot, i) => {{
        dot.classList.toggle('active', i === currentSlide);
    }});
    
    // Update progress bar
    const progress = ((currentSlide + 1) / totalSlides) * 100;
    document.querySelector('.progress-fill').style.width = progress + '%';
}}

function nextSlide() {{
    if (currentSlide < totalSlides - 1) {{
        currentSlide++;
        updateSlide();
    }}
}}

function prevSlide() {{
    if (currentSlide > 0) {{
        currentSlide--;
        updateSlide();
    }}
}}

function goToSlide(index) {{
    currentSlide = index;
    updateSlide();
}}

// Click to advance
document.querySelector('.carousel').addEventListener('click', (e) => {{
    if (!e.target.closest('.nav-btn') && !e.target.closest('.dot') && !e.target.closest('a')) {{
        nextSlide();
    }}
}});

// Keyboard navigation
document.addEventListener('keydown', (e) => {{
    if (e.key === 'ArrowRight' || e.key === ' ') nextSlide();
    if (e.key === 'ArrowLeft') prevSlide();
}});

// Touch swipe support
let touchStartX = 0;
let touchEndX = 0;

document.querySelector('.carousel').addEventListener('touchstart', e => {{
    touchStartX = e.changedTouches[0].screenX;
}}, false);

document.querySelector('.carousel').addEventListener('touchend', e => {{
    touchEndX = e.changedTouches[0].screenX;
    if (touchStartX - touchEndX > 50) nextSlide();
    if (touchEndX - touchStartX > 50) prevSlide();
}}, false);
</script>
'''))
```
